---
title: 命令行调用
sidebar_position: 10
---

import HexViewer from '@site/src/components/HexViewer';

该命令行为了方便测试运行的正确性，添加了加密的选项。你可以使用命令行进行加密文件的生成。

```sh title="使用 v2 解密/加密"
cargo run kugou --slot-key-1 "base64:MDlBWg==" \
  sample/test_kgm_header_v2.kgm decrypted.ogg

cargo run kugou --slot-key-1 "base64:MDlBWg==" \
  --encrypt-header "@sample/kgm_header_v2.bin" \
  sample/test_121529_32kbps.ogg enc_v2.kgm
```

```sh title="使用 v3 解密/加密"
cargo run kugou --slot-key-1 "base64:MDlBWg==" \
  sample/test_kgm_header_v3.kgm decrypted.ogg

cargo run kugou --slot-key-1 "base64:MDlBWg==" \
  --encrypt-header "@sample/kgm_header_v3.bin" \
  sample/test_121529_32kbps.ogg enc_v3.kgm
```

```sh title="使用 v4 解密/加密"
cargo run kugou --slot-key-1 "base64:MDlBWg==" \
  --v4-file-key-expansion-table "@sample/test_kgm_v4_filekey_table.bin" \
  --v4-slot-key-expansion-table "@sample/test_kgm_v4_slotkey_table.bin" \
  sample/test_kgm_header_v4.kgm decrypted.ogg

cargo run kugou --slot-key-1 "base64:MDlBWg==" \
  --encrypt-header "@sample/kgm_header_v4.bin" \
  --v4-file-key-expansion-table "@sample/test_kgm_v4_filekey_table.bin" \
  --v4-slot-key-expansion-table "@sample/test_kgm_v4_slotkey_table.bin" \
  sample/test_121529_32kbps.ogg enc_v4.kgm
```

### 参数

- `--slot-key-1` - 插槽序号对应的密钥。
- `--encrypt-header` - 切换为加密模式，并使用指定的模板进行加密。
- `--v4-file-key-expansion-table` - 用于文件密钥处理的展开表（v4 限定）。
- `--v4-slot-key-expansion-table` - 用于插槽密钥处理的展开表（v4 限定）。

之后附加两个参数，分别为 `输入文件路径` 与 `输出文件路径`。

### 测试密钥

1 号插槽：

<HexViewer
  title={<pre>--slot-key-1 "base64:MDlBWg=="</pre>}
  data="hex:3039415A"
/>

2 号加密使用的文件头示例：

<HexViewer
  title={<pre>--encrypt-header "@sample/kgm_header_v2.bin"</pre>}
  data={`hex:
    7C D5 32 EB 86 02 7F 4B A8 AF A6 8E 0F FF 99 14
    00 04 00 00 02 00 00 00 01 00 00 00 5B 46 69 6C
    65 4B 65 79 53 69 67 6E 61 74 75 5D 5B 44 65 63
    72 79 70 74 69 6F 6E 20 4B 65 79 5D 00 00 00 00
  `}
/>

3 号加密使用的文件头示例：

<HexViewer
  title={<pre>--encrypt-header "@sample/kgm_header_v3.bin"</pre>}
  data={`hex:
    7C D5 32 EB 86 02 7F 4B A8 AF A6 8E 0F FF 99 14
    00 04 00 00 03 00 00 00 01 00 00 00 5B 46 69 6C
    65 4B 65 79 53 69 67 6E 61 74 75 5D 5B 44 65 63
    72 79 70 74 69 6F 6E 20 4B 65 79 5D 00 00 00 00
  `}
/>

4 号加密使用的文件密钥展开表：

<HexViewer
  title={
    <pre>
      --v4-file-key-expansion-table "@sample/test_kgm_v4_filekey_table.bin"
    </pre>
  }
  data={`hex:
    4C 6F 72 65 6D 20 69 70 73 75 6D 20 64 6F 6C 6F
    72 20 73 69 74 20 61 6D 65 74 2C 20 63 6F 6E 73
    65 63 74 65 74 75 72 20 61 64 69 70 69 73 63 69
    6E 67 20 65 6C 69 74 2E 20 4E 75 6C 6C 61 6D 20
    6D 61 78 69 6D 75 73 20 69 61 63 75 6C 69 73 20
    6E 75 6C 6C 61 20 73 65 64 20 66 72 69 6E 67 69
    6C 6C 61 2E 20 53 65 64 20 6E 65 71 75 65 20 6C
    65 6F 2C 20 73 6F 64 61 6C 65 73 20 61 74 20 6C
    69 67 75 6C 61 20 69 64 2C 20 70 72 65 74 69 75
    6D 20 62 69 62 65 6E 64 75 6D 20 61 75 67 75 65
    2E 20 41 6C 69 71 75 61 6D 20 76 65 68 69 63 75
    6C 61 20 65 72 6F 73 20 6E 6F 6E 20 6E 75 6E 63
    20 6D 61 74 74 69 73 20 66 61 75 63 69 62 75 73
    2E 20 53 65 64 20 65 67 65 74 20 6D 69 20 76 69
    74 61 65 20 65 78 20 67 72 61 76 69 64 61 20 72
    75 74 72 75 6D 2E 20 44 75 69 73 20 76 69 74 61
    65 20 66 65 6C 69 73 20 65 74 20 74 75 72 70 69
    73 20 69 6E 74 65 72 64 75 6D 20 62 6C 61 6E 64
    69 74 2E 20 4E 75 6C 6C 61 6D 20 76 69 74 61 65
    20 65 73 74 20 69 6E 74 65 72 64 75 6D 2C 20 6F
    72 6E 61 72 65 20 64 69 61 6D 20 73 69 74 20 61
    6D 65 74 2C 20 64 69 67 6E 69 73 73 69 6D 20 61
    72 63 75 2E 20 44 6F 6E 65 63 20 6D 6F 6C 65 73
    74 69 65 20 76 65 6E 65 6E 61 74 69 73 20 73 63
    65 6C 65 72 69 73 71 75 65 2E 20 44 75 69 73 20
    66 69 6E 69 62 75 73 20 6D 61 6C 65 73 75 61 64
    61 20 64 6F 6C 6F 72 20 73 65 64 20 69 61 63 75
    6C 69 73 2E 20 51 75 69 73 71 75 65 20 6D 61 78
    69 6D 75 73 20 6E 69 62 68 20 6D 61 75 72 69 73
    2C 20 61 20 64 61 70 69 62 75 73 20 6D 69 20 72
    68 6F 6E 63 75 73 20 72 68 6F 6E 63 75 73 2E 20
    50 65 6C 6C 65 6E 74 65 73 71 75 65 20 68 61 62
    69 74 61 6E 74 20 6D 6F 72 62 69 20 74 72 69 73
    74 69 71 75 65 20 73 65 6E 65 63 74 75 73 20 65
    74 20 6E 65 74 75 73 20 65 74 20 6D 61 6C 65 73
    75 61 64 61 20 66 61 6D 65 73 20 61 63 20 74 75
    72 70 69 73 20 65 67 65 73 74 61 73 2E 20 55 74
    20 74 72 69 73 74 69 71 75 65 20 61 63 20 6E 75
    6C 6C 61 20 73 65 64 20 69 6D 70 65 72 64 69 65
    74 2E 20 41 65 6E 65 61 6E 20 64 69 67 6E 69 73
    73 69 6D 20 74 6F 72 74 6F 72 20 76 65 6C 20 65
    78 20 70 6F 72 74 61 2C 20 61 20 63 6F 6E 76 61
    6C 6C 69 73 20 6C 61 63 75 73 20 62 6C 61 6E 64
    69 74 2E 38 39 34 31 36 39 31 32 33 38 33 34 30
    39
  `}
/>

4 号加密使用的文件密码槽展开表：

<HexViewer
  title={
    <pre>
      --v4-slot-key-expansion-table "@sample/test_kgm_v4_slotkey_table.bin"
    </pre>
  }
  data={`hex:
    4C 6F 72 65 6D 20 69 70 73 75 6D 20 64 6F 6C 6F
    72 20 73 69 74 20 61 6D 65 74 2C 20 63 6F 6E 73
    65 63 74 65 74 75 72 20 61 64 69 70 69 73 63 69
    6E 67 20 65 6C 69 74 2E 20 53 65 64 20 71 75 69
    73 20 6F 72 6E 61 72 65 20 6E 69 62 68 2E 20 44
    6F 6E 65 63 20 76 69 76 65 72 72 61 20 68 65 6E
    64 72 65 72 69 74 20 61 6C 69 71 75 61 6D 2E 20
    4D 6F 72 62 69 20 65 67 65 73 74 61 73 20 70 75
    6C 76 69 6E 61 72 20 6E 65 71 75 65 20 65 74 20
    70 65 6C 6C 65 6E 74 65 73 71 75 65 2E 20 53 75
    73 70 65 6E 64 69 73 73 65 20 66 65 72 6D 65 6E
    74 75 6D 20 62 69 62 65 6E 64 75 6D 20 72 69 73
    75 73 20 71 75 69 73 20 66 72 69 6E 67 69 6C 6C
    61 2E 20 44 75 69 73 20 65 75 20 76 69 76 65 72
    72 61 20 6D 61 73 73 61 2E 20 45 74 69 61 6D 20
    6E 6F 6E 20 6E 69 73 69 20 73 65 64 20 72 69 73
    75 73 20 64 69 67 6E 69 73 73 69 6D 20 74 69 6E
    63 69 64 75 6E 74 2E 20 50 72 61 65 73 65 6E 74
    20 72 75 74 72 75 6D 20 69 6E 74 65 72 64 75 6D
    20 74 72 69 73 74 69 71 75 65 2E 20 41 6C 69 71
    75 61 6D 20 63 6F 6E 64 69 6D 65 6E 74 75 6D 20
    64 69 61 6D 20 76 65 6C 20 74 72 69 73 74 69 71
    75 65 20 66 65 72 6D 65 6E 74 75 6D 2E 20 4E 75
    6E 63 20 75 6C 74 72 69 63 65 73 20 6C 6F 62 6F
    72 74 69 73 20 6E 75 6E 63 20 63 6F 6E 76 61 6C
    6C 69 73 20 63 6F 6D 6D 6F 64 6F 2E 20 51 75 69
    73 71 75 65 20 65 67 65 73 74 61 73 20 6D 65 74
    75 73 20 76 69 74 61 65 20 65 78 20 64 69 63 74
    75 6D 2C 20 76 65 6C 20 66 72 69 6E 67 69 6C 6C
    61 20 69 70 73 75 6D 20 6D 61 6C 65 73 75 61 64
    61 2E 20 41 65 6E 65 61 6E 20 61 63 20 6D 61 74
    74 69 73 20 65 73 74 2E 20 46 75 73 63 65 20 65
    75 20 75 6C 74 72 69 63 69 65 73 20 61 75 67 75
    65 2E 20 44 75 69 73 20 65 67 65 74 20 6C 61 6F
    72 65 65 74 20 6C 6F 72 65 6D 2E 20 53 65 64 20
    63 6F 6E 67 75 65 20 69 70 73 75 6D 20 65 67 65
    74 20 66 65 72 6D 65 6E 74 75 6D 20 65 67 65 73
    74 61 73 2E 20 50 72 61 65 73 65 6E 74 20 66 61
    75 63 69 62 75 73 20 76 65 68 69 63 75 6C 61 20
    6D 61 75 72 69 73 20 76 69 74 61 65 20 61 75 63
    74 6F 72 2E 20 4D 61 65 63 65 6E 61 73 20 72 75
    74 72 75 6D 20 65 6C 69 74 20 65 75 20 74 75 72
    70 69 73 20 6F 72 6E 61 72 65 2C 20 69 64 20 73
    6F 6C 6C 69 63 69 74 75 64 69 6E 20 64 75 69 20
    6D 61 78 69 6D 75 73 2E
  `}
/>
