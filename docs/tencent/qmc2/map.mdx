---
title: 解密算法 (MAP)
sidebar_position: 110
---

import CodeRef from '@site/src/components/CodeRef';
import WarnQMC from '../_warn_qmc_7fff.mdx';

Rust 的参考实现：

- <CodeRef at="1dcb48a" file="src/tencent/qmc2_decryptor_map.rs#L56" />
- <CodeRef at="1dcb48a" file="src/tencent/qmc_legacy_block.rs#L10" />

<WarnQMC />

```py title="伪代码示例"
fn decrypt_file(offset, input: byte):
  # 0x7fff 是一个特殊情况
  if offset == 0x7fff:
    i = 0x7fff
  else:
    i = offset % 0x7fff

  key_index = (i * i + 71214) % key.size()
  rotation = (key_index + 4) % 8
  final_key = (key[key_index] << rotation) | (key[key_index] >> rotation)

  result = byte XOR final_key
```
